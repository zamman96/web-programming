<!DOCTYPE html>
<html lang="kr">
<head>
  <title>회원가입</title>
  <meta charset="utf-8">
  <script src="../js/jquery-3.7.1.js"></script>
  <script src="../js/jquery.serializejson.min.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
  </style>
  <script>
 $(function(){
	 $('#idBtn').on('click',function(){
		 let vid = $('#id').val().trim();
		 if(vid.length<1){
			 alert("아이디를 입력하세요");
			 return;
		 }
		 
// 		 fetch('/Jqpro/idChk.do',{
// 			 method : "POST",
// 			 headers : {
// 				 "Content-type" : "application/x-www-form-urlencoded" // 직렬화X
// 			 },
// 			 body : "mem_id="+vid
// 		 })
		 fetch('/Jqpro/idChk.do?mem_id='+vid)
		 .then(function(response){
			console.log("response", response);
			if(!response.ok){
				throw new Error(`오류발생 : ${response.status}`);
			}
			return response.text(); 
// 			return response.json();
		})
		.then(function(data){
			//data는 결과를 text로 받은 변수
			$('#chkid').html(data);
// 			$('#chkid').html(data.flag);
		})
		
	 })
	 $('#zipBtn').on('click',function(){
			window.open("./view/zip.html","주소","width=500 height=800 top=200 left=300");
	 })
	 
	 
 	// 입력 데이터 체크하기 - 입력과 동시에 - keyup() 이벤트
	$('#id').on('keyup', function(){
		
		// 입력한 값
		idvalue = $(this).val();
		
		// 규칙 영문자로 시작해서 숫자와 조합해서 4~12글자의 아이디
		regid = /^[a-zA-Z][a-zA-Z0-9]{3,12}$/;
		
		// 규칙에 입력값이 올바른지 비교 - test() - true/false 리턴
		if(regid.test(idvalue)){
			$(this).css('border', '2px solid green');
			$('#idBtn').prop('disabled',false);
		}else{
			$(this).css('border', '2px solid red');
			$('#idBtn').prop('disabled',true);
		}
		
	})
	$('#name').on('keyup', function(){
		
		// 입력한 값
		namevalue = $(this).val();
		
		// 한글 2글자이상 6글자이상
		regname = /^[가-힣]{2,6}$/;
		
		// 규칙에 입력값이 올바른지 비교 - test() - true/false 리턴
		if(regname.test(namevalue)){
			$(this).css('border', '2px solid green');
		}else{
			$(this).css('border', '2px solid red');
		}
		
	}) 
	
	$('#hp').on('keyup',function(){
		// 전화번호
		hpvalue = $(this).val()
		
		reghp = /^[0-9]{3}-[0-9]{4}-[0-9]{4}$/;
		
		if(reghp.test(hpvalue)){
			$(this).css('border', '2px solid green');
		}else{
			$(this).css('border', '2px solid red');
		}
	})
	 
	 // 저장하기 - 가입하기
	 $('#submit').on('click',function(){
		 
		 // 입력데이터 가져오기 - 9개

		 
		 // 라이브러리없이 사용가능
		 fdata1 = $('#ff').serialize();
		 fdata2 = $('#ff').serializeArray();
		 fdata3 = $('#ff').serializeJSON();
		
		 console.log(fdata1);
		 console.log(fdata2);
		 console.log(fdata3);
		 
		 /*
		 // id체크
		 idvalue = fdata3.mem_id;
		// 규칙 영문자로 시작해서 숫자와 조합해서 4~12글자의 아이디
		regid = /^[a-zA-Z][a-zA-Z0-9]{3,12}$/;
			
			// 규칙에 입력값이 올바른지 비교 - test() - true/false 리턴
		if(regid.test(idvalue)){
			$('#id').css('border', '2px solid green');
			$('#idBtn').prop('disabled',false);
		}else{
			$('#id').css('border', '2px solid red');
			$('#idBtn').prop('disabled',true);
			return false;	// 끝나게
		}
			
		// name체크
		namevalue = fdata3.mem_name;
		
		// 한글 2글자이상 6글자이상
		regname = /^[가-힣]{2,6}$/;
		
		// 규칙에 입력값이 올바른지 비교 - test() - true/false 리턴
		if(regname.test(namevalue)){
			$('#name').css('border', '2px solid green');
		}else{
			$('#name').css('border', '2px solid red');
		}
		
		*/
		
		
		 if($('#chkOK').length==0){
			 alert('중복검사를 해주세요');
			 return;
		 }
		 //POST
		fetch("/Jqpro/InsertM.do",{
		method : "POST",
		headers : {
			"Content-type" : "application/json;charset=utf-8" // json 직렬화
		},
// 			body : JSON.stringify({mem_id : vid, mem_pass : vpw, mem_name : vname, mem_hp : vhp, mem_bir : vbir, mem_mail : vmail, mem_zip : vzip, mem_add1 : vadd1, mem_add2 : vadd2}) // json
			body : JSON.stringify(fdata3)
		}) 
		 .then(function(response){
			console.log("response", response);
			if(!response.ok){
				throw new Error(`오류발생 : ${response.status}`);
			}
// 			return response.text();
			return response.json();
		})
		.then(function(data){
			console.log(data);
// 			$('#res').html(data);
			$('#res').html(data.flag);
		})
		
	 })
	 
	 // 저장하기 - 가입하기 - form id=ff button[type=submit]
	 $('#ff').on('submit',function(ev){
		 // 기존에 이미 정해져 있는 기능을 취소
		 ev.preventDefault()
// 		 event.preventDefault()
	 })
 })
  
  </script>
  <style>
.mb-3 input{
	width: 300px;
}
.flex{
	display: flex;
}
input{
	margin-right: 20px;
}
  </style>
</head>
<body>

<div class="container mt-3">
  <h2>회원 가입</h2>
  <br>
  <form action="" id="ff">
    <div class="mb-3">
      <label for="id">아이디:</label>
      <!-- db칼럼과 name일치 -->
      <div class="flex">
      <input type="text" class="form-control" id="id" name="mem_id"> 
      <button class="btn btn-outline-primary btn-sm" type="button" id="idBtn">중복검사</button>
      </div>
      <span id="chkid"></span>
    </div>
    <div class="mb-3">
      <label for="pwd">비밀번호:</label>
      <input type="password" class="form-control" id="pass" name="mem_pass">
    </div>
    <div class="mb-3">
      <label for="name">이름:</label>
      <input type="text" class="form-control" id="name" name="mem_name"> <!-- db칼럼과 name일치 -->
    </div>
    <div class="mb-3">
      <label for="hp">전화번호:</label>
      <input type="text" class="form-control" id="hp" name="mem_hp"> <!-- db칼럼과 name일치 -->
    </div>
    <div class="mb-3">
      <label for="bir">생일:</label>
      <input type="date" class="form-control" id="bir" name="mem_bir"> <!-- db칼럼과 name일치 -->
    </div>
    <div class="mb-3">
      <label for="email">Email:</label>
      <input type="email" class="form-control" id="mail" name="mem_mail"> <!-- db칼럼과 name일치 -->
    </div>
    <div class="mb-3">
      <label for="zip">우편번호:</label>
      <div class="flex">
      	<input type="text" class="form-control" id="zip" name="mem_zip"> <!-- db칼럼과 name일치 -->
      <button class="btn btn-outline-primary btn-sm" type="button" id="zipBtn">검색</button>
      </div>
    </div>
    <div class="mb-4">
      <label for="add1">주소:</label>
      <input type="text" class="form-control" id="add1" name="mem_add1"> <!-- db칼럼과 name일치 -->
    </div>
    <div class="mb-4">
      <label for="add2">상세주소:</label>
      <input type="text" class="form-control" id="add2" name="mem_add2"> <!-- db칼럼과 name일치 -->
    </div>
    <button type="submit" class="btn btn-primary" id="submit">Submit</button>
  </form>
</div>
<br>
<div id="res"></div>
</body>
</html>
