<!DOCTYPE html>
<html lang="kr">
<head>
  <title>회원가입</title>
  <meta charset="utf-8">
  <script src="http://localhost/Jqpro/js/jquery-3.7.1.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
  tr:hover{
  	background : teal;
  }
  </style>
  <script>
 $(function(){
	 $('#zipBtn').on('click',function(){
		 let vdong = $('#id').val().trim();
		 if(vdong.length<1){
			 alert("동을 입력하세요");
			 return;
		 }
		 console.log(vdong);
// 		 fetch('/Jqpro/ZipSearch.do?dong='+vdong)
		 fetch("/Jqpro/ZipSearch.do",{
		method : "POST",
		headers : {
			"Content-type" : "application/json;charset=utf-8" // json 직렬화
		},
			body : JSON.stringify({dong : vdong}) // json
		})
		 .then(function(response){
			console.log("response", response);
			if(!response.ok){
				throw new Error(`오류발생 : ${response.status}`);
			}
			return response.json();
		})
		.then(function(data){
			let code = `<table border='1'><tr><th>우편번호</th><th>시</th><th>군</th><th>동</th><th>번지</th></tr>`;
			$.each(data, function(){
				let bunji = this.bunji;
				if(typeof bunji == "undefined"){
					bunji = "";
				}
				
				code+=`<tr class="zip">
				<td id="code">
					${this.zipcode}
				</td>
				<td id="sido">
					${this.sido}
				</td>
				<td id="gugun">
					${this.gugun}
				</td>
				<td id="dong">
					${this.dong}
				</td>
				<td id="bunji">
					${bunji}
				</td>
			</tr>`;
			})
			code+=`</table>`;
			
			$('#result').html(code);
		})
	 })
	 
	 $(document).on('click','.zip',function(){
		 let value = $("#code", this).text().trim();
		 let add = $("#sido", this).text().trim() + " " + $("#gugun", this).text().trim()
		 + " " + $("#dong", this).text().trim();
		 console.log(value);
		 window.opener.document.querySelector('#zip').value = value;
		 window.opener.document.querySelector('#add1').value = add;
			
		window.close();
	 })
 })
  
  </script>
  <style>
.mb-3 input{
	width: 300px;
}
.flex{
	display: flex;
}
input{
	margin-right: 20px;
}
  </style>
</head>
<body>

<div class="container mt-3">
  <h3>우편번호 검색</h2>
  <br>
  <form action="">
    <div class="mb-3">
      <label for="id">동 검색:</label>
      <div class="flex">
      <input type="text" class="form-control" id="id" name="dong"> 
      <button class="btn btn-outline-primary btn-sm" type="button" id="zipBtn">주소검색</button>
      </div>
    </div>
  </form>
  <div id="result"></div>
</div>

</body>
</html>
