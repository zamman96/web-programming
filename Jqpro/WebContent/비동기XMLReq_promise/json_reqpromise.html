<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="../CSS/public.css"> 
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="http://localhost/Jqpro/js/jquery-3.7.1.js"></script>
<style>
.res{
	display: flex;
}
.res div{
	box-sizing : border-box;
	flex : 25%;
}
</style>
<script>
const xhr = new XMLHttpRequest();
$(function() {
	$('#text').on('click', function(){
		getData('text.jsp')
		.then((text)=>{
			// text = xhr.responseText
			// 개나리/무궁화/진달래/삼천리/강아지/고양이
			res = text.trim().split("/");
			return res
		})
		.then(data => {
			// 윗 단계에서 처리 후 return한 결과값을 data변수로 받음
			res = `<ul>`;
			for(i=0; i<data.length;i++){
				res+=`<li>${data[i]}</li>`;
			}
			res += `</ul>`;
			$('#result1').html(res);
		})
	})
	
	$('#jsonarr').on('click', function(){
		getData('jsonarr.jsp')
		.then((data)=>{
			res = JSON.parse(data);
			return res;
		})
		.then(data => {
			// 윗 단계에서 처리 후 return한 결과값을 data변수로 받음
			res = `<ol>`;
			for(i=0; i<data.length;i++){
				res+=`<li>${data[i]}</li>`;
			}
			res += `</ol>`;
			$('#result2').html(res);
		})
	})
	
	$('#jsonobj').on('click', function(){
		getData('jobj.jsp')
		.then(function(text){
			res = JSON.parse(text);
			
			return res;
		})
		.then((data) => {
			code = `<p>이름 : ${res.name} </p>
				<p>주소 : ${res.addr}</p>
				<p>전화번호 : ${res.tel}</p>`;
			$('#result3').html(code);
		})
	})
	
	$('#jobarr').on('click', function(){
		getData('jobarr.jsp')
		.then((data)=>{
			res = JSON.parse(data);
			code="";
			$.each(res, function(){
				code += `<p>이름 : ${this.name} </p>
					<p>주소 : ${this.addr}</p>
					<p>전화번호 : ${this.tel}</p><hr color="gray">`;
			})
			$('#result4').html(code);
		})
		
	})
	
})

function getData(url){
	return new Promise((resolve, reject) => {
		xhr.open("GET", url);
// 		xhr.onload = function(){resolve(this.responseText)};
		xhr.onload = () => resolve(xhr.responseText);
// 		xhr.onerror = () => reject(xhr.statusText);
		xhr.onerror = () => reject(new Error("오류가 발생했어요"));
		xhr.send();
	})
}
</script>
</head>
<body>

	<div class="box">
		<h3></h3>
		<input type="button" value="text" id="text"> 
		<input type="button" value="arr" id="jsonarr"> 
		<input type="button" value="jsonobj" id="jsonobj"> 
		<input type="button" value="jobarr" id="jobarr"> 
		<br> <br>
		<form action="MemberList.do">
		<input type="submit">
		</form>
	<div class="res">
		<div id="result1"></div>
		<div id="result2"></div>
		<div id="result3"></div>
		<div id="result4"></div>
	</div>
	</div>
</body>
</html>